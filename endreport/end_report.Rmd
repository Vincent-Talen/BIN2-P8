---
output:
  pdf_document:
    includes:
      in_header: report_subfiles/import.tex
      before_body: report_subfiles/before_body.tex

bibliography: report_subfiles/references.bib
citation-style: report_subfiles/ieee.csl
link-citations: true
nocite: '@*'
---

```{r, include=FALSE}
# Copyright (c) 2023 Vincent Talen.
# Licensed under GPLv3. See LICENSE file.
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(fig.align = "center")
knitr::opts_chunk$set(fig.pos = "H", out.extra = "")
```

\newpage
<!-- (Introduction) -->
# Introduction
Climate change is a rising threat to the earth, the average overall surface temperature is predicted to increase by 0.2°C per decade and up to 2–5°C by the end of this century, leading to massive disruptions at all levels of biological organization across ecosystems *[@Dawson2011; @Walther2002]*. Life-history traits, population dynamics, species interactions and ecological processes are strongly influenced by temperature *[@Dell2011; @Sommer2012; @Woodward2010]*, especially physiological traits related to energy acquisition and expenditure *[@Brown2004]*, such as metabolic rate *[@Dillon2010; @Marshall-McQuaid2011]* and ingestion rate *[@Rall2012; @Vucic-Pestic2011]*, which together determine the energy balance of organisms. Furthermore, most organisms are ectotherms *[@Bickford2011]* on who temperature has an even greater effect *[@Angilletta2002]*, thus a key in understanding ecosystems' response to global warming is understanding the thermal physiology of ectotherms *[@Deutsch2008]*.

A powerful framework to investigate ecosystem functioning in the context of global warming is the Metabolic Theory of Ecology (MTE) *[@Brown2004]*. It combines the effects of body mass and temperature on biochemical processes in order to predict individual physiological performances *[@Gillooly2001; @West2003]*, this can then be scaled up from individuals to population, community and ecosystem levels *[@Allen2005]*. As metabolic losses increase exponentially with warming, organisms generally increase energy supply through nutrient ingestion *[@Sentis2012; @Lemoine2014]*, but metabolism increases more rapidly than nutrient ingestion with temperature. The resulting mismatch causes a decreasing energetic efficiency as temperature rises *[@Bideault2021]*, but has not been studied or measured directly.

Despite the functional significance and vulnerability to warming of detritivore populations *[@Boyero2012; @Wenisch2017]*, most studies on the impact of global warming on consumer-resource dynamics have mainly focused on carnivore and herbivore populations. Detritivores are heterotrophs that consume plant litter and decompose them into smaller inorganic molecules, performing what is called the first stage of remineralisation. These inorganic compounds can then be used by primary producers, such as plants and algae, to synthesize new organic molecules, completing the nutrient cycle in the ecosystem. Thus, leaf litter decomposition by detritivores is a crucial process in the ecosystem as it allows the nutrients stored in organic matter to be recycled and reused by other organisms.

Previous studies have not yet fully explained how thermal constraints on detritivores scale up to their entire ecosystems. Thermal bio-energetic models are greatly relevant for studying the impact of temperature and body size changes on detritivore-resource dynamics *[@Bernhardt2018; @Osmond2017; @Sentis2017]* and understanding the balance between key physiological processes that determine detritivore fitness *[@Jabiol2020]* is crucial for predicting the responses of populations and freshwater ecosystems to global warming *[@Bideault2021; @Demars2011; @Yvon-Durocher2010]*.

The goal of this research is to improve and expand on the research done by *Réveillon et al. [@Réveillon2022]* on the modelling of the consumer-resource dynamics by greatly improving the model code written in R, resulting in better reproducibility of this research and it being more easily expandable. *Réveillon et al.* investigated the thermal energetic mismatch between energy demand (i.e. metabolic rate) and supply (i.e. ingestion rate) and simulated the consequences of this thermal mismatch for seasonal population dynamics and carbon fluxes *[@Réveillon2022]*.

\newpage
<!-- (Theory/Model) -->
## Theory
The consumer-resource model created by *Réveillon et al.* describes the seasonal dynamics of *Gammarus Fossarum* and Leaf Litter biomasses in a temperate stream, a diagram showing an overview of the system dynamics can be seen below in Figure \ref{fig:model_diagram}. Even though the model assumes that all individuals of the population have the same body mass, the exploration on the effects of temperature-induced changes in population body size is still possible. The fluctuation in Gammarus population biomass is driven by the balance between carbon intake through food ingestion and carbon loss through respiration. Changes in leaf litter biomass are due to herbivory pressure of Gammarus on seasonal litter fall stock.

```{r model_diagram, out.width = "75%", fig.cap = "Diagram showing dynamics of the model (Made by Vincent Talen)"}
knitr::include_graphics("figures/Model Diagram Annotated.png")
```

<!-- (State variables) -->
### State variables
The model has two state variables, leaf litter standing stocks ($L$) and *Gammarus* population biomass ($G$), both in in $mg\:C/m^2$. Both state variables have an ordinary differential equation (ODE) that describes their temporal change, Equation \ref{eq:odeleaflitter} and \ref{eq:odegammaruspopulation} respectively.

\odeleaflitter
\odegammaruspopulation

The standing stock of leaf litter is sustained by the seasonal leaf litter fall inputs ($I$) and decreases due to feeding activity by the *Gammarus* population ($f(L)_T\:G$) and litter decomposition ($k_T\:L$) by other degradation processes (e.g. microbial decomposition and leaching). Dynamics of the *Gammarus* population is described as the balance of carbon intake through litter ingestion ($f(L)_T\:A_T$) and loss through respiration ($RMR_T$), henceforth Routine Metabolic Rate ($RMR$). Each of the parameters of these two ODEs is described by their own equation and dependent on temperature, except for leaf litter input, all parameters are shown in Table \ref{tab:State-Variable-Parameters} below.

| Parameter           | Equation | Unit                              | Explanation
|----                 |---       |-----------                        |--------------------
| $I$                 | -        | $mg\:C \: m^{2}$                  | Leaf litter input
| $f(L)_{\mathrm{T}}$ | 2        | $mg\:C \: mg\:C^{-1} \: day^{-1}$ | Gammarus functional response
| $RMR_{\mathrm{T}}$  | 3b       | $mg\:C/day$                       | Gammarus routine metabolic rate
| $A_{\mathrm{T}}$    | 4        | -                                 | Gammarus assimilation efficiency
| $k_{\mathrm{T}}$    | 5        | $day^{-1}$                        | Leaf litter microbial decomposition
Table: Model state variables' parameters \label{tab:State-Variable-Parameters}

<!-- (Parameters) -->
### Parameter equations
The first parameter that is used in both differential equations is the *Gammarus* population feeding rate, which follows the Holling type II functional response (Equation \ref{eq:hollingtypetwo}).

\hollingtypetwo

with $a_{\mathrm{T}}$ being the *Gammarus* attack rate on leaves ($mg^{-2}/day$), $h_{\mathrm{T}}$ the *Gammarus* handling time ($day^{-1}$), both at temperature $T$, and with $L$ being the leaf litter biomass in $mg\:C/m^2$. Attack rate is estimated by assuming that the proportion of ingested leaf litter follows an exponential decay of time, which can be calculated as $DC_{\mathrm{T}} = -log(1-IR_{\mathrm{T}} * t/M_L)$. Where $IR_{\mathrm{T}}$ is the daily leaf ingestion rate ($IR$) at temperature T ($mg\:C \: mg\:C^{-1} \: day^{-1}$) calculated with Equation \ref{eq:mtequadratic}, $t$ is the duration of the experiment (d) and $M_L$ is the mean initial C mass of leaf discs in microcosms (i.e. 10.25 mg C). After the decay rate is calculated the attack rate can finally be calculated by dividing the estimated decay rate by the experimental duration ($a_{\mathrm{T}} = DC_{\mathrm{T}} / t$). The handling time is calculated as the inverse of the ingestion rate ($h_{\mathrm{T}} = 1 / IR_{\mathrm{T}}$).

To express the mass ($M$) and temperature ($T$) dependence of the $RMR$ and $IR$ of individuals the following equations were used:
To express the dependence of $RMR$ and $IR$ of individuals on mass ($M$) and temperature ($T$) the following equations using the MTE formula were used:

\mtestandard
\mtequadratic

where $\alpha$ is the metabolic or the ingestion expression level at reference temperature $T_0$, $b$ is the mass-scaling exponent, $M$ is the dry body mass (mg), $Ea$ is the activation energy (eV) and $k_B$ is the Boltzmann's constant ($8.62 * 10^{-5} \: eV \: K^{-1}$).  
To allow for the investigation into the curvature strength of the relationship between the measured rate (I) and temperature, a deviation of the MTE expression is used within Equation \ref{eq:mtequadratic}'s exponential term. The curvature is described by the fitted polynomial first- and second-order terms `p` and `q`, respectively *[@Englund2011; @Irlich2009]*. If $q = 0$ is used in the quadratic formulation (Equation \ref{eq:mtequadratic}) and the equation is reduced to the MTE model, then `p` can be interpreted as the activation energy *[@Englund2011]*. This particular case is formulated as Equation \ref{eq:mtestandard}.

To express the temperature dependence of assimilation efficiency ($A_T$), empirical equations and values for detritivores from *Lang et al. [@Lang2017]* are used. So the assimilation efficiency is confined between 0 and 1 (no assimilation or complete assimilation) a logistic equation is used where the MTE equation is used both at the numerator and denominator, resulting in Equation \ref{eq:assimilationefficiency}.

\assimilationefficiency

where $\alpha$ is the normalization constant of assimilation efficiency, $Ea$ is the activation energy (eV) and $k_B$ is the Boltzmann's constant ($8.62 * 10^{-5} \: eV \: K^{-1}$).

The temperature dependence of microbial decomposition is expressed using the Arrhenius equation, since carbon fluxes in aquatic ecosystems are largely caused by microbial decomposition *[@Schneider2012]* causing leaf litter to also be affected by this.

\leafdecompositionrate

where $k_{10°C}$ is the leaf litter decomposition rate at 10°C (283.15K), $Ea$ is the activation energy (eV) and $k_B$ is the Boltzmann's constant.


\newpage
<!-- (Materials and Methods) -->
# Materials and Methods
## The software model
<!-- - Describe the software tools used, as well as the libraries -->
<!-- - Describe the software implementation -->

## Model configuration
<!-- Explain chosen initial state, parameter values and time sequence. Use tables with values. -->





\newpage
<!-- (Results) -->
# Results
<!-- Introduction of results, how does it answer your research questions.   -->

<!-- - Describe what can be seen in such way that it leads to an answer to your research questions -->
<!-- - Give your figures a number and a descriptive title. -->
<!-- - Provide correct axis labels (unit and quantity), legend and caption. -->
<!-- - Always refer to and discuss your figures and tables in the text - they never stand alone. -->


\newpage
<!-- (Discussion and Conclusion) -->
# Discussion and Conclusion
## Discussion
<!-- - Compare your results with what is expecting from the literature and discuss differences with them. -->
<!-- - Discuss striking and surprising results. -->
<!-- - Discuss weaknesses in your research and how they could be addressed. -->
- Basically unreproducible in general, long pieces of code that were repeated over and over that could not be understood. No easy way to reproduce other than to immediately copy and paste multiple hundreds lines of code where only few values would be changed.
- Formulas for metabolic and ingestion rates were heavily rewritten from the base formula. They were unrecognizable so they were cleaned up to be understandable and resemble the actual formula more. It should also be noted that the position where the mean in the quadratic portion of the exponent is actually different from what would be done following the formula.

## General conclusion and perspective
<!-- Discuss what your goal was, what the end result is and how you could continue working from here. -->


<!-- (After-Body) -->
```{r after body, child = 'report_subfiles/after_body.Rmd'}
```
